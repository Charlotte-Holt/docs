// Copyright (c) 2020 IBM Corporation and others.
// Licensed under Creative Commons Attribution-NoDerivatives
// 4.0 International (CC BY-ND 4.0)
//   https://creativecommons.org/licenses/by-nd/4.0/
//
// Contributors:
//     IBM Corporation
//
:page-description:
:seo-title: Authorization in Open Liberty
:seo-description: Authorization determines which resources a user can access in an application that is running on Open Liberty.
:page-layout: general-reference
:page-type: general
= Authorization in Open Liberty

For an application to be secure, it must be able to manage access to protected resources. Authorization determines which resources a user can access.

In an application where only certain users or groups are entitled to access certain resources, users and groups are assigned roles that represent which resources they can access. For example, in a payroll application, users in the `Employee` role can view a page that lists their hourly wages and hours worked. However, only users in the `Manager` role can edit employee wages. During link:/docs/ref/general/#authentication.html[authentication], Open Liberty identifies users, what groups they might be in, and which roles they have. When a user attempts to access a protected resource on the server, this information is used to determine whether the user is authorized to access the resource.

In the following diagram, a user requests access to protected resources in an application. During authentication (steps 1-4), the user's identity and security roles are confirmed. During authorization (steps 5-6), the roles that are specified for the user are checked against the roles that are defined for the application resources. The user is granted access to any resources that match their role.

image::/docs/img/authn-2.1.png[Authentication diagram,align="center"]
== Define user roles in your application code

User roles are defined directly in the application. These roles are mapped by the server configuration to user groups that are specified by the user registry or single sign-on provider. It is possible to avoid defining roles if you specify group names that match the role names exactly. In this case, the server maps the group to the role with a matching name by default.

Roles can be defined in the application by setting the `@DeclareRoles` annotation in the `server.xml` file.
To map the roles to user groups from a user registry or single sign-on provider, specify the `<security-role>` element within the `<application-bnd>` element in the `server.xml` file. If you use the default mapping by matching group names to role names exactly, you do not need specify an `<application-bnd>` element in the `server.xml` file.

Although the `@DeclareRoles` annotation is the most common way to define user roles in microservices, it is also possible to define roles by specifying `<security-role>` elements in a `web.xml` deployment descriptor file. For an example of this configuration, see link:guides/security-intro.html#adding-authentication-and-authorization[the Adding authentication and authorization section of the Securing a web application guide].

== Set application resource permissions

Typically, a developer can specify which roles are allowed to access an application resource directly in the source code by setting the `@RolesAllowed` annotation to contain the permissible roles. When a user is authenticated, the access groups to which the user is assigned are retrieved from a user registry or single sign-on (SSO) provider. The Open Liberty server maps these groups to the roles that are defined in the application. If the role or roles that are mapped to the user match the roles that are specified for the resource, the user is granted access.

In cases where an SSO provider is configured, the userâ€™s credentials are retrieved from a token (such as a JSON Web Token). This token can then propagate the identity of the authenticated user to application resources in an efficient, self-contained way

In some use cases, an application needs to know only whether a user is authenticated or not. In such cases, configuration can be simplified by specifying `"**"` as the role name in the `@RolesAllowed` annotation or XML configuration. This value denotes that any authenticated user can access a resource. It is also possible to authorize all users by setting the `@PermitAll` annotation, which specifies that a resource is accessible to everyone, even users who are not authenticated.

As an alternative to the `@RolesAllowed` annotation, you can define the `@ServletSecurity` annotation in the `HomeServlet.java` file with the `@HttpConstraint` annotation and set the `rolesAllowed` attribute to the permissible roles. In this configuration, role mappings are defined either in `application-bnd` stanzas in the `server.xml` file or in an `ibm-application-bnd.xml` file in the application.

== Authorize requests between web services

Authorization occurs not only between users and applications, but also between microservices within an application. When one service requests data from another, the requesting service often must be able to demonstrate that it is authorized to access the data. Token-based authorization, link:/docs/ref/general/#sso-config-jwt.html[such as with JSON Web Tokens (JWT)], provides a lightweight way for security controls and security tokens to propagate user identities and roles across different services. Open Liberty supports token-based authorization through the link:/docs/ref/feature/#jwt-1.0.html[MicroProfile JWT feature].

== Secure your applications with Open Liberty

Ready to try out authorization with Open Liberty for yourself? Check out these guides for securing applications:

- Learn how to secure a web application through authentication and authorization in the guide to link:/guides/security-intro.html[Securing a web application].
- Explore how to control user and role access to microservices with JSON Web Tokens in the guide to link:/guides/microprofile-jwt.html[Securing microservices with JSON Web Tokens].
