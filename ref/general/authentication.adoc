// Copyright (c) 2020 IBM Corporation and others.
// Licensed under Creative Commons Attribution-NoDerivatives
// 4.0 International (CC BY-ND 4.0)
//   https://creativecommons.org/licenses/by-nd/4.0/
//
// Contributors:
//     IBM Corporation
//
:page-description:
:seo-title: Authentication in Open Liberty
:seo-description: Authentication is the processes by which an application that is running on Open Liberty confirms a user's identity.
:page-layout: general-reference
:page-type: general
= Authentication in Open Liberty

In order for an application to be secure, it must be able to determine who its users are. Authentication is the process of confirming a user’s identity.

Open Liberty authenticates users by collecting credentials from them, such as a username and password, and checking these credentials against a configured registry of users. There are a number of different ways that authentication can be carried out, depending on the details of an application and the resources that are available to it. For microservice-based applications, it’s important that authentication is lightweight and configurable, since any user request might need to authenticate to multiple services. In many cases, a user's credentials are placed in a token that can be passed from the server to different microservices to authenticate requests for protected resources.

For example, a user of a music streaming service might want to listen to a song, learn about the artist, and get recommendations for similar artists. Each of these tasks would require access to a different service, but having to authenticate for each of them separately uses unnecessary time and resources. Open Liberty supports a number of different strategies for single sign-on (SSO) authentication so that a user or service must authenticate only once to access the various resources in an application. For example, the link:/docs/ref/feature/#socialLogin-1.0.html[Social Media Login] feature enables users of an application that is running on Open Liberty to authenticate through their social media login. After authentication, an application can either obtain a JSON Web Token (JWT) from the social media service or associated OpenID Connect provider, or create a new one. This JWT can then be used to authenticate the user to any service in the application.

image::/docs/img/Authentication.png[Authentication diagram,align="center"]

== User registries
A user registry is a database that contains information about a set of users and their associated roles. When a user requests a protected resource in an application, the user's credentials are checked against the information in one or more user registries. Open Liberty provides an easy-to-use link:/docs/ref/general/#basic-registry.html[basic user registry] for developers to use in test environments. Typically, applications in production are configured to use an external registry, such as a link:/docs/ref/general/#LDAP-registry.html[Lightweight Directory Access Protocol (LDAP) registry].

Open Liberty also supports link:/docs/ref/general/#federated-registries.html[federated user registries] so that a server can be configured to authenticate from multiple registries from a single logical view. Information from LDAP, basic, and custom user registries can be federated into a common registry to manage application security.

If your application needs to reference a security database that cannot move to the local operating system or an external LDAP registry, you can configure a custom registry by implementing the `com.ibm.websphere.security.UserRegistry` interface in the Open Liberty Server. The `UserRegistry` interface is a Service Programming Interface (SPI) that enables support to virtually any type of account repository.

== Single sign-on (SSO)
SSO enables users to authenticate at one location and access multiple servers or services without being repeatedly prompted to log in. SSO is especially important for microservice-based applications, where a single user request might require authentication to several different microservices. SSO for applications that run on Open Liberty is supported by using the Lightweight Third Party Access (LTPA) protocol. The LTPA protocol uses cryptographic keys to share user data between servers that use the same user registry. When the link:/docs/ref/feature/#appSecurity-3.0.html[appSecurity-2.0] (or later) feature is enabled in Open Liberty, LTPA keys are automatically created if they do not exist.

When a user authenticates to one Open Liberty server, an SSO token is created for that user and is put in a cookie. The cookie is then sent to the HTTP client, for example, a browser. If the same user makes a request to access another application that is on a different server, but in the same SSO configuration, the cookie is sent along with the request. The receiving server uses the LTPA keys to decrypt the users credentials from the token in the cookie. If the receiving server can validate the token, the user is authenticated without being prompted for another login. If the token cannot be validated (for example, it cannot decrypt or verify the token because of an LTPA key mismatch), the user is prompted to enter the credential information again.

Open Liberty supports the following options for SSO authentication:

- link:/docs/ref/feature/#socialLogin-1.0.html[Social Media Login] +
Users can authenticate to websites that are hosted on the Open Liberty server by logging in with their social media accounts. When the `socialLogin-1.0` feature is enabled, login with Facebook, Twitter, Google, Linkedin, and GitHub is automatically configured. You can also define your own configuration for any social media platform that is based on the OAuth 2.0 or OpenID Connect 1.0 standards.

- link:/docs/ref/general/#/docs/concept/sso-config-ltpa.html[LTPA cookies] +
Lightweight Third Party Authentication (LTPA) provides SSO configuration support to authenticate users when they are accessing application servers. With LTPA enabled, you can encrypt, digitally sign, and securely transmit authentication-related data between servers.

- link:/docs/ref/feature/#openidConnectServer-1.0.html[OpenID Connect]  +
OIDC is a popular internet SSO protocol that works well with cloud-native applications. This protocol enables a client application to request the identity of the user as an ID token in a standardized, REST-like manner. The client application, or Relying Party, requests information about a user from an authorization server, known as an OpenID Connect Provider. After users are authenticated by an OpenID Provider, they can access any Relying Party that is configured for that Provider, without having to manage unique accounts for each application or website.

- link:/docs/ref/general/#/docs/concept/sso-config-saml.html[Security Assertion Markup Language (SAML 2.0)] +
SAML Web Browser SSO enables web applications to delegate user authentication to a SAML identity provider instead of a configured user registry.

- link:/docs/ref/feature/#spnego-1.0.html[Simple and Protected GSS-API Negotiation Mechanism (SPNEGO)] +
With SPNEGO SSO, users log in to the Microsoft Domain controller once to access and move between protected resources on Open Liberty servers without getting prompted for additional logins.

== Secure your applications with Open Liberty

Ready to try out authentication with Open Liberty for yourself? Check out these guides for securing applications.

- Learn how to secure a web application through authentication and authorization in this guide to link:/guides/security-intro.html[Securing a web application].
- Explore how to control user and role access to microservices with JSON Web Tokens in this guide to link:/guides/microprofile-jwt.html[Securing microservices with JSON Web Tokens].
